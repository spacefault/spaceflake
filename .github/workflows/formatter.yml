name: Formatting Check & PR

on: [push]

jobs:
 format:
   runs-on: ubuntu-latest

   steps:
   - name: Checkout code
     uses: actions/checkout@v4

   - name: Setup Nix
     uses: DeterminateSystems/nix-installer-action@v9

   - name: Format Nix Files
     run: |
       nix run nixpkgs#alejandra -- .
       if git diff --quiet; then
           echo "No changes made."
           exit 0
       else
           git config --global push.default current
           git checkout -b formatting-update
           git config --global user.email "github-actions[bot]@users.noreply.github.com"
           git config --global user.name "github-actions[bot]"
           git commit -am "Formatting Update"
           git push
       fi

   - name: Create Pull Request
     uses: peter-evans/create-pull-request@v3
     with:
       token: ${{ secrets.GITHUB_TOKEN }}
       branch: "formatting-update"
       delete-branch: true
       title: "Formatting Update"
       body: "This PR formats the files in the repository."
       labels: "auto-generated"
     if: steps.fmt.outputs.changed == 'true'
