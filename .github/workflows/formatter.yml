name: Format Nix Files

on: [push]

jobs:
 format:
   runs-on: ubuntu-latest

   steps:
   - name: Checkout code
     uses: actions/checkout@v2

   - name: Setup Nix
     uses: DeterminateSystems/nix-installer-action@v9

   - name: Install alejandra
     run: nix-env -iA nixpkgs.alejandra 

   - name: Format Nix Files
     run: |
       alejandra -- .
       if git diff --quiet; then
           echo "No changes made."
           exit 0
       else
           git config --global user.email "github-actions[bot]@users.noreply.github.com"
           git config --global user.name "github-actions[bot]"
           git commit -am "Apply nixpkgs-fmt"
           git push
       fi
